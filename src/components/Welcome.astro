---
import BaseLayout from '../layouts/BlogLayout.astro';
import { getCollection } from 'astro:content';
import profile from '../assets/profile.jpeg';

// Current date for relative time calculation
const currentDate = new Date('2025-09-07T17:58:00+0545');

// Get all blog posts sorted by date
const allPosts = await getCollection('blog');
const latestPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate))
  .slice(0, 3); // Get 3 most recent posts

// Calculate category counts
const categories = Array.from(new Set(allPosts.flatMap(post => post.data.tags || ['misc'])))
  .map(tag => ({
    name: tag,
    count: allPosts.filter(post => post.data.tags?.includes(tag) || !post.data.tags).length
  }));

// Function to calculate relative time
const getRelativeTime = (date) => {
  const diffMs = currentDate - new Date(date);
  const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  return diffDays === 0 ? 'Today' : `${diffDays} days ago`;
};
---

  <main class="min-h-screen p-4 md:p-8 bg-white">
    <div class="container max-w-6xl mx-auto">
      <!-- Hero Section with Profile Image -->
      <section class="flex flex-col md:flex-row items-center md:items-start justify-between mb-10 gap-6">
        <!-- Hero Text -->
        <div class="text-center md:text-left md:w-2/3">
          <div class="inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-medium mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            Welcome to my digital space
          </div>
          <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">I'm Madan, Web Designer & Student</h1>
          <p class="text-gray-700 text-base max-w-2xl mx-auto md:mx-0 mb-4 leading-relaxed">
            I am a Computer Engineering student fueled by curiosity, exploring web design, software development, and AI to create practical digital solutions.
          </p>
        </div>

        <!-- Profile Image -->
        <div class="relative group md:w-1/3 text-center">
          <div class="absolute inset-0 rounded-full bg-gradient-to-r from-blue-400 to-purple-400 blur-lg opacity-0 group-hover:opacity-40 transition-opacity duration-300 -z-10"></div>
          <img 
            src={profile.src} 
            alt="Madan Belbase" 
            aria-label="Profile picture of Madan Belbase"
            width="120"
            height="120"
            loading="lazy"
            class="w-24 h-24 md:w-30 md:h-30 rounded-full border-2 border-white shadow-md 
                   transform group-hover:scale-105 transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)]
                   ring-1 ring-offset-1 ring-blue-300/30 ring-offset-blue-50/20 mx-auto"
          />
        </div>
      </section>

      <!-- Recently Published Section -->
      <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Blog Posts -->
        <div class="lg:col-span-2 space-y-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-4">Recently published</h2>
          {latestPosts.map(post => (
            <article class="p-5 bg-gray-50 rounded-lg border border-gray-200 hover:bg-white hover:shadow-md transition-all duration-200">
              <h3 class="text-xl font-semibold text-gray-900 mb-2" aria-label={`Blog post: ${post.data.title}`}>
                {post.data.title}
              </h3>
              <p class="text-sm text-gray-600 mb-2">
                {getRelativeTime(post.data.pubDate)} • {Math.ceil(post.body.split(' ').length / 200)} min read
              </p>
              <p class="text-gray-700 text-base mb-4 leading-relaxed">{post.data.description}</p>
              <a href={`/blog/${post.slug}/`} 
                 class="text-blue-600 font-medium hover:underline flex items-center gap-1 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded-lg transition duration-200"
                 aria-label={`Read more about ${post.data.title}`}>
                Read post <span aria-hidden="true">→</span>
              </a>
            </article>
          ))}
        </div>

        <!-- Categories Sidebar -->
        <aside class="space-y-6">
          <div class="space-y-4">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Read more on</h2>
            {categories.map(category => (
              <div>
                <a href={`/blog/tag/${category.name.toLowerCase()}/`} 
                   class="flex items-center justify-between text-gray-700 hover:text-blue-600 text-base py-2 border-b border-gray-200 hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded-lg"
                   aria-label={`View posts in ${category.name} category`}>
                  <span>{category.name}</span>
                  <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2 py-1 rounded-full" aria-hidden="true">{category.count}</span>
                </a>
              </div>
            ))}
            <a href="/blog/" 
               class="text-blue-600 font-medium hover:underline block mt-4 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:rounded-lg"
               aria-label="View all categories">All categories</a>
          </div>
        </aside>
      </section>
    </div>
  </main>

  <style is:global>
    /* Smooth & modern focus styles */
    a:focus,
    button:focus {
      outline: none;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); /* soft blue glow */
      border-radius: 8px;
      transition: box-shadow 0.3s ease, transform 0.2s ease;
    }

    a:focus-visible,
    button:focus-visible {
      transform: scale(1.02); /* subtle zoom */
    }

    /* Responsive adjustments */
    @media (max-width: 1024px) {
      .md:flex-row {
        flex-direction: column;
      }
      .md:w-2/3,
      .md:w-1/3 {
        width: 100%;
      }
      .lg:grid-cols-3 {
        grid-template-columns: 1fr;
      }
      .lg:col-span-2 {
        grid-column: span 1;
      }
      .p-5 {
        padding: 1rem;
      }
      .w-24.h-24 {
        width: 20%;
        height: 20%;
      }
      .md:w-30.md:h-30 {
        width: 25%;
        height: 25%;
      }
    }
  </style>

