---
import BaseLayout from '../layouts/BlogLayout.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import profile from '../assets/profile.jpeg';

// Current date for relative time calculation
const currentDate = new Date('2025-09-11T21:00:00+0545');

// Get all blog posts sorted by date
const allPosts = await getCollection('blog');
const latestPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 5);

// Calculate category counts
const categories = Array.from(new Set(allPosts.flatMap(post => post.data.tags ?? ['misc'])))
  .map(tag => ({
    name: tag,
    count: allPosts.filter(post => post.data.tags?.includes(tag) ?? tag === 'misc').length
  }))
  .sort((a, b) => b.count - a.count);

const getRelativeTime = (date: string | Date): string => {
  try {
    const currentDate = new Date();
    const diffMs = currentDate.getTime() - new Date(date).getTime();
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    if (diffDays === 0) return 'Today';
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    return new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric' }).format(new Date(date));
  } catch {
    return 'Unknown date';
  }
};
---

<main class="min-h-screen ">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 md:px-8 py-8 md:py-12">
    
    <!-- Hero Section with Profile Image -->
    <section class="flex flex-col md:flex-row items-center md:items-start justify-between mb-16 gap-8">
      
      <!-- Hero Text -->
      <div class="text-center md:text-left md:w-2/3">
        <div class="inline-flex items-center px-3 py-1.5 rounded-full bg-blue-50 text-blue-700 text-sm font-medium mb-4 border border-blue-100">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
          Welcome to my digital space
        </div>
        
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold text-gray-900 mb-4 tracking-tight leading-tight">
          I'm Madan, Web Designer & Student
        </h1>
        
        <p class="text-gray-600 text-base sm:text-lg max-w-2xl mx-auto md:mx-0 mb-6 leading-relaxed">
          I'm a Computer Engineering student passionate about web design, software development, and AI, crafting practical and innovative digital solutions.
        </p>
        
        <a
          href="/about"
          class="inline-flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors duration-200 font-medium"
          aria-label="Learn more about Madan Belbase"
        >
          About Me <span aria-hidden="true">→</span>
        </a>
      </div>

      <!-- Profile Image -->
      <div class="relative group md:w-1/3">
        <div class="absolute inset-0 rounded-full bg-gradient-to-r from-blue-400 to-indigo-400 blur-xl opacity-0 group-hover:opacity-40 transition-opacity duration-300"></div>
        <img
          src={profile.src}
          alt="Madan Belbase"
          aria-label="Profile picture of Madan Belbase"
          width={192}
          height={192}
          loading="lazy"
          class="relative w-32 h-32 sm:w-40 sm:h-40 md:w-48 md:h-48 rounded-full border-4 border-white shadow-xl mx-auto
                 transform group-hover:scale-105 transition-transform duration-300
                 ring-4 ring-offset-4 ring-blue-100 ring-offset-gray-50"
        />
      </div>
    </section>

    <!-- Recently Published Section -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Blog Posts -->
      <div class="lg:col-span-2">
        <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-8">Recently Published</h2>
        
        <div class="space-y-6">
          {latestPosts.map(post => (
            <article
              class="bg-white p-6 sm:p-8 rounded-xl border border-gray-200 shadow-sm hover:shadow-md hover:border-blue-200 transition-all duration-200"
              aria-labelledby={`post-title-${post.slug}`}
            >
              <h3 id={`post-title-${post.slug}`} class="text-xl sm:text-2xl font-bold text-gray-900 mb-3 leading-tight">
                <a href={`/blog/${post.slug}/`} class="hover:text-blue-600 transition-colors duration-200">
                  {post.data.title}
                </a>
              </h3>
              
              <div class="flex items-center gap-3 text-sm text-gray-500 mb-4">
                <time datetime={post.data.pubDate} class="font-medium">{getRelativeTime(post.data.pubDate)}</time>
                <span class="text-gray-300">•</span>
                <span>{Math.ceil(post.body.split(' ').length / 200)} min read</span>
              </div>
              
              <p class="text-gray-600 text-base mb-5 leading-relaxed">
                {post.data.description}
              </p>
              
              <a
                href={`/blog/${post.slug}/`}
                class="inline-flex items-center gap-1.5 text-blue-600 font-semibold focus:outline-none"
                aria-label={`Read more about ${post.data.title}`}
              >
                Read post <span aria-hidden="true">→</span>
              </a>
            </article>
          ))}
        </div>
        
        <div class="mt-8">
          <a
            href="/blog/"
            class="inline-flex items-center gap-2 text-blue-600 font-medium hover:text-blue-700 transition-colors duration-200"
            aria-label="View all blog posts"
          >
            View all posts <span aria-hidden="true">→</span>
          </a>
        </div>
      </div>

      <!-- Categories Sidebar -->
      <aside class="lg:col-span-1">
        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm sticky top-8">
          <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-6">Explore by Category</h2>
          
          <div class="space-y-1">
            {categories.map(category => (
              <a
                href={`/blog/tag/${category.name.toLowerCase()}/`}
                class="flex items-center justify-between text-gray-700 hover:text-blue-600 hover:bg-blue-50 text-base py-3 px-3 rounded-lg transition-all duration-200 focus:outline-none group"
                aria-label={`View posts in ${category.name} category`}
              >
                <span class="font-medium">{category.name}</span>
                <span class="bg-blue-50 text-blue-700 text-xs font-semibold px-2.5 py-1 rounded-full group-hover:bg-blue-600 group-hover:text-white transition-colors duration-200" aria-hidden="true">
                  {category.count}
                </span>
              </a>
            ))}
          </div>
          
          <div class="mt-6 pt-6 border-t border-gray-200">
            <a
              href="/blog/"
              class="block text-center py-2.5 px-4 bg-gray-50 text-gray-700 rounded-lg font-medium hover:bg-blue-50 hover:text-blue-600 transition-all duration-200 focus:outline-none"
              aria-label="View all categories"
            >
              Browse All Categories
            </a>
          </div>
        </div>
      </aside>
    </section>
  </div>
</main>

<style is:global>
  /* Fonts */
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    color: #1e293b;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  html {
    scroll-behavior: smooth;
  }

  /* Clean focus styles - only visible for keyboard navigation */
  a:focus {
    outline: none;
  }

  a:focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* Remove tap highlight on mobile */
  * {
    -webkit-tap-highlight-color: transparent;
  }

  /* Responsive adjustments */
  @media (max-width: 1024px) {
    .md:flex-row {
      flex-direction: column;
    }
    .lg:grid-cols-3 {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 640px) {
    .text-3xl {
      font-size: 1.875rem;
    }
    .text-4xl {
      font-size: 2.25rem;
    }
    .text-5xl {
      font-size: 2.5rem;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>